<!DOCTYPE HTML>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>Arrow: The Ultimate Weapon</title>
    <script type="text/javascript" src="simpleGame.js"></script>
    <script type="text/javascript">
        const ANGLE_UP = -0.52;
        const ANGLE_DOWN = 0.78;

        var side_left_line, side_right_line, top_line, down_line
        var game;
        var me, bow
        var enemy, enemyDown = false
        var arrow, arrowAngle, arrowHasLaunch = false, arrowHasCollide = false;
        var readylabel, hintslabel, welldonelabel;

        function Up() {
            line = new Sprite(game, "upLine.png", 5, 700);
            line.setPosition(5, 250)
            line.setSpeed(0)

            return line
        }
        function Down() {
            line = new Sprite(game, "upLine.png", 5, 700);
            line.setPosition(798, 250)
            line.setSpeed(0)


            return line
        }
        function Left() {
            line = new Sprite(game, "upLine.png", 1000, 5);
            line.setPosition(400, 565)
            line.setSpeed(0)

            return line
        }
        function Right() {
            line = new Sprite(game, "upLine.png", 1000, 5);
            line.setPosition(400, 2)
            line.setSpeed(0)

            return line
        }
        function WelldoneLabel() {
            label = new Sprite(game, "welldone.png", 300, 100);
            label.setSpeed(0)
            label.setPosition(650, 520)
            label.hide()

            return label;
        }
        function HintsLabel() {
            label = new Sprite(game, "hintsLabel.png", 750, 100);
            label.setSpeed(0)
            label.setPosition(390, 520)
            label.hide()

            return label;
        }
        function ReadyLabel() {
            label = new Sprite(game, "readylabel.png", 500, 100);
            label.setSpeed(0)
            label.setPosition(500, 520)

            label.checkKeys = function () {
                if (keysDown[K_ENTER]) {
                    this.hide();

                    hintslabel.show();

                    me.standBy();
                }
            }

            return label;
        }
        function Arrow() {
            arrow = new Sprite(game, "arrow.png", 50, 70);
            arrow.setSpeed(0)
            arrow.setPosition(107, 80)
            arrow.hide()

            arrow.launch = function () {
                arrow.show();
                arrow.setSpeed(10);
                arrowHasLaunch = true;
            }

            arrow.isCollide = function () {
                if (arrow.collidesWith(side_left_line)) {
                    arrowHasCollide = true;
                }
                else if (arrow.collidesWith(side_right_line)) {
                    arrowHasCollide = true;
                }
                else if (arrow.collidesWith(top_line)) {
                    arrowHasCollide = true;
                }
                else if (arrow.collidesWith(down_line)) {
                    arrowHasCollide = true;
                }
                else if(arrow.collidesWith(enemy)) {
                    enemyDown = true
                }

                if (arrowHasCollide) {

                    arrowHasLaunch = false;
                }
                else if(enemyDown) {
                    arrow.hide()
                    enemy.hide()
                    hintslabel.hide()
                    welldonelabel.show()
                }
            }

            return arrow;
        }
        function Bow() {
            bow = new Sprite(game, "bow.png", 50, 70)
            bow.setSpeed(0)
            bow.setPosition(107, 80)
            bow.hide();

            bow.checkKeys = function () {
                if (keysDown[K_W]) {
                    if (this.moveAngle >= ANGLE_UP) {
                        this.changeAngleBy(-5)
                        if (!arrowHasLaunch)
                            arrow.changeAngleBy(-5)
                    }
                }
                else if (keysDown[K_S]) {
                    if (this.moveAngle <= ANGLE_DOWN) {
                        this.changeAngleBy(5)
                        if (!arrowHasLaunch)
                            arrow.changeAngleBy(5)
                    }
                }
                else if (keysDown[K_E]) {
                    if (!arrowHasLaunch)
                        arrow.launch()
                }
            }

            return bow;
        }
        function Me() {
            me = new Sprite(game, "me_standby.png", 70, 100);

            me.setSpeed(0)
            me.setPosition(100, 100)

            me.standBy = function () {
                me = new Sprite(game, "me_arrowing.png", 70, 100);
                me.setSpeed(0)
                me.setPosition(100, 100)

                bow.show();
            }

            return me;
        }
        function Enemy() {
            enem = new Sprite(game, "arrowing.png", 70, 120);

            enem.setSpeed(0)
            enem.setPosition(500, 300)

            return enem;
        }
        function init() {
            game = new Scene();
            game.setBG("#666666");
            me = new Me();
            enemy = new Enemy();
            bow = new Bow();
            arrow = new Arrow();

            //LINE 
            top_line = new Up();
            down_line = new Down();
            side_left_line = new Left();
            side_right_line = new Right();

            readylabel = new ReadyLabel();
            hintslabel = new HintsLabel();
            welldonelabel = new WelldoneLabel()
            game.start();
        } // end init

        function update() {
            game.clear();

            me.update();

            enemy.update();

            bow.checkKeys();
            bow.update();

            arrow.isCollide();
            arrow.update();

            top_line.update();
            down_line.update();
            side_left_line.update();
            side_right_line.update();

            readylabel.checkKeys();
            readylabel.update();
            hintslabel.update();
            welldonelabel.update();
        }


    </script>

</head>

<body onload="init()">

</body>

</html>